-- Credit goes to Sangeeth for this script. https://sangeethwiki.blogspot.com/2017/10/get-organisation-hierarchies-through-x.html
SELECT 
  T1.NAME AS HIERARCHYNAME, 
  T2.CHILDORGANIZATION AS CHILDORGANIZATION, 
  T2.PARENTORGANIZATION AS PARENTORGANIZATION, 
  T2.HIERARCHYTYPE AS HIERARCHYTYPE, 
  T3.NAME AS PARENT, 
  T4.NAME AS CHILD, 
  T5.OMOPERATINGUNITTYPE AS ChildOMOPERATINGUNITTYPE, 
  T5.OMOPERATINGUNITNUMBER AS ChildOMOPERATINGUNITNUMBER, 
  T6.OMOPERATINGUNITNUMBER AS ParentOMOPERATINGUNITNUMBER, 
  T6.OMOPERATINGUNITTYPE AS ParentOMOPERATINGUNITTYPE 
FROM 
  OMHIERARCHYTYPE T1 CROSS 
  JOIN OMHIERARCHYRELATIONSHIP T2 
  LEFT OUTER JOIN DIRPARTYTABLE T3 ON (T2.PARENTORGANIZATION = T3.RECID) 
  LEFT OUTER JOIN DIRPARTYTABLE T4 ON (T2.CHILDORGANIZATION = T4.RECID) 
  LEFT OUTER JOIN DIRPARTYTABLE T5 ON (
    (T4.RECID = T5.RECID) 
    AND (
      T5.INSTANCERELATIONTYPE IN (2377)
    )
  ) 
  LEFT OUTER JOIN DIRPARTYTABLE T6 ON (
    (T3.RECID = T6.RECID) 
    AND (
      T6.INSTANCERELATIONTYPE IN (2377)
    )
  ) 
WHERE 
  (
    NOT (
      (T2.PARENTORGANIZATION = 0)
    ) 
    AND (T1.RECID = T2.HIERARCHYTYPE)
  )
